#!/bin/sh

FILENAME=localconfig.pri

cat > ${FILENAME} << EOF
#
# This file has been generated by the configure script of the
# meegotouch-controlpanelapplets package. The file will be automatically
# overwritten, please do not modify.
#
EOF

which pkg-config > /dev/null
if [ $? -eq 0 ]; then
    #
    # Most of applets needs the path for restore-settings/clean-user-data scripts
    #
    RFS_DIR=$(pkg-config clean-device --variable=rfs_scripts_dir)
    CUD_DIR=$(pkg-config clean-device --variable=cud_scripts_dir)
    echo "RFS_DIR = ${RFS_DIR}" >> ${FILENAME}
    echo "CUD_DIR = ${CUD_DIR}" >> ${FILENAME}

    #
    # We have a heavy QmSystem2 dependency in the displayapplet and in the
    # batteryapplet. This is the most important closed source dependency of the
    # source
    #
    pkg-config --exists qmsystem2
    if [ $? -eq 0 ]; then
        echo "DEFINES += HAVE_QMSYSTEM" >> ${FILENAME}
    fi

    #
    # The wallpaper applet uses the contentmaneger to implement the 'select from
    # my gallery' widget.
    #
    pkg-config --exists ContentManager
    if [ $? -eq 0 ]; then
        echo "DEFINES += HAVE_CONTENT_MANAGER" >> ${FILENAME}
    fi
fi

#
# We also have some dependency towards the profile Qt library in the profile
# applet.
#
if [ -e /usr/include/profile-qt/profile.h ]; then
    echo "DEFINES += HAVE_PROFILE_QT" >> ${FILENAME}
fi

#
# We need also the DBus interfaces names, and some meta-type registration
# from devicelock-dev header (in reset-settings applet)
#
if [ -e /usr/include/devicelock/devicelock.h ]; then
    echo "DEFINES += HAVE_DEVICELOCK" >> ${FILENAME}
fi

#
# Optionally we need to check for UserGuide application
# XXX: This 'HelpButton' widget will be moved to MTF, so then remove this!!!
#
if [ -e /usr/include/userguide/HelpButton ]; then
    echo "DEFINES += HAVE_USERGUIDE" >> ${FILENAME}
fi

#echo "# All values were removed for testing purposes..." > ${FILENAME}

echo Configured meegotouch-controlpanelapplets as follows:
echo =====================================================
cat ${FILENAME}
